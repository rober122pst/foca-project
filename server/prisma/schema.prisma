datasource db {
    provider  = "postgresql"
    url       = env("DATABASE_URL")
    directUrl = env("DIRECT_URL")
}

generator client {
    provider = "prisma-client-js"
}

model User {
    id            String         @id @default(dbgenerated()) @db.Uuid
    email         String         @unique
    name          String         @unique
    password      String
    role          String         @default("USER")
    isVerified    Boolean        @default(false)
    createdAt     DateTime       @default(now())
    updatedAt     DateTime       @updatedAt
    profile       Profile?
    config        Config?
    refreshTokens refreshToken[]
}

enum Theme {
    DARK
    LIGHT
    SYSTEM
}

model Config {
    id       String @id @default(dbgenerated()) @db.Uuid
    userId   String @unique @db.Uuid
    user     User   @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    theme    Theme  @default(SYSTEM)
    language Int    @default(1)
}

model Profile {
    id               String            @id @default(dbgenerated()) @db.Uuid
    userId           String            @unique @db.Uuid
    user             User              @relation(fields: [userId], references: [id], onDelete: Cascade, onUpdate: Cascade)
    picUrl           String            @default("")
    bannerUrl        String            @default("")
    bio              String            @default("")
    followers        Int               @default(0)
    following        Int               @default(0)
    userAchiviements UserAchiviement[]
    routines         Routine[]
    tasks            Task[]
    gamefication     Gamefication?
}

model Gamefication {
    id            String  @id @default(dbgenerated()) @db.Uuid
    profileId     String  @unique @db.Uuid
    profile       Profile @relation(fields: [profileId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    level         Int     @default(1)
    xp            Int     @default(0)
    coins         Float   @default(0)
    streakCurrent Int     @default(0)
    streakBest    Int     @default(0)
    meta          Json?
}

enum Priority {
    LOW
    MEDIUM
    HIGH
}

model Task {
    id          String    @id @default(dbgenerated()) @db.Uuid
    profileId   String    @db.Uuid
    profile     Profile   @relation(fields: [profileId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    title       String
    description String?
    completed   Boolean   @default(false)
    completedAt DateTime?
    deadline    DateTime?
    priority    Priority  @default(LOW)
    tags        String[]
    isRecurring Boolean   @default(false)
    createAt    DateTime  @default(now())
    updateAt    DateTime  @updatedAt
}

enum Weekday {
    SUN
    MON
    TWE
    WED
    THU
    FRI
    SAT
}

model Routine {
    id              String     @id @default(dbgenerated()) @db.Uuid
    profileId       String     @db.Uuid
    profile         Profile    @relation(fields: [profileId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    description     String?
    frequency       Weekday[]  @default([SUN, MON, TWE, WED, THU, FRI, SAT])
    timeStart       String
    timeEnd         String
    completedToday  Boolean    @default(false)
    completedDays   DateTime[]
    lastCompletedAt DateTime
    createAt        DateTime   @default(now())
    updateAt        DateTime   @updatedAt
}

enum Rarity {
    COMMON
    RARE
}

model Achiviement {
    id               String            @id @default(dbgenerated()) @db.Uuid
    name             String
    description      String
    iconUrl          String
    total            Int?
    rarity           Rarity            @default(COMMON)
    xpReward         Int
    coinReward       Float
    criteria         Json
    createAt         DateTime          @default(now())
    updateAt         DateTime          @updatedAt
    userAchiviements UserAchiviement[]
}

model UserAchiviement {
    id            String      @id @default(dbgenerated()) @db.Uuid
    profileId     String      @db.Uuid
    profile       Profile     @relation(fields: [profileId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    achiviementId String      @db.Uuid
    achiviement   Achiviement @relation(fields: [achiviementId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    progress      Int         @default(0)
    achievedAt    DateTime?

    @@unique([profileId, achiviementId])
}

model refreshToken {
    id        String   @id @default(dbgenerated()) @db.Uuid
    token     String   @unique
    userId    String   @db.Uuid
    user      User     @relation(fields: [userId], references: [id], onUpdate: Cascade, onDelete: Cascade)
    createdAt DateTime @default(now())
    expiresAt DateTime
}
